<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connect Bank</title>
  <script src="https://cdn.teller.io/connect/connect.js"></script>
</head>

<body>
  <p id="text" align="center">Connecting to teller</p>
  <script>
    /**
     * @param {"teller" | "plaid"} source
     * @param {string} token
    */
    async function sendToken(source, token) {
      await fetch("/token", {
        body: {
          source: source,
          token: token
        },
        method: "POST"
      });

      if (window.ENV.isWebView) {
        window.close();
      }
    }

    document.addEventListener("DOMContentLoaded", function () {

      // Initialise the Teller Connect SDK as usual. Note the extra property `skipPicker`. 
      // This lets us know you won't be displaying our picker or consent screens.
      // It's advised you set this otherwise the user may briefly see a flash of our 
      // consent screen when Teller intercepts the enrollment process

      const teller = TellerConnect.setup({
        skipPicker: true,
        applicationId: window.ENV.teller.app_id,
        onInit: ()=>{
          document.getElementById("text").innerHTML = "";
        },
        onSuccess: async function (enrollment) {
          document.getElementById("text").innerHTML = "Successful. Return to the app";
          await sendToken("teller", enrollment.accessToken);
        },
        onExit: async () => {
          document.getElementById("text").innerHTML = "Failed. Return to the app";
          await fetch("/teller", {
            method: "DELETE"
          });
        }
      });

      teller.open();
    })
  </script>
</body>

</html>